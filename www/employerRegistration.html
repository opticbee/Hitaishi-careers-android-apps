<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Employer Registration</title>
    <link rel="icon" href="https://winjob.in/images/favicon.ico" type="image/x-icon">
    <!-- Font Awesome for the back button icon -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <!-- Bootstrap CSS CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        :root {
            --primary-color: #6a0dad;
            --dark-text: #333333;
            --light-gray: #f8f9fa;
        }

        body, html {
            min-height: 100%;
        }
        
        body {
            background-color: var(--light-gray);
            /* Increased padding-top to give space for the fixed header bar (35px margin + padding) */
            padding-top: 80px; 
        }

        .container-wrapper {
            display: flex;
            align-items: flex-start; /* Align to the top of the viewport minus padding */
            justify-content: center;
            min-height: calc(100vh - 80px); /* Adjust min-height based on padding-top */
            padding: 30px 0; /* Extra padding for centering below the header */
        }

        .card {
            border-radius: 0.75rem;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }

        /* --- MOBILE-FRIENDLY HEADER BAR STYLES --- */
        #mobile-header-bar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000; 
            /* 35px margin top + 15px padding bottom = 50px total height + padding for content */
            padding: 35px 15px 15px 15px; 
            display: flex;
            align-items: center;
            background-color: var(--light-gray); /* Match body background */
        }

        #back-button {
            background: none;
            border: none;
            color: var(--dark-text);
            font-size: 1.5rem;
            padding: 0;
            margin-right: 10px;
            cursor: pointer;
        }

        #header-logo-title .fw-bold {
            color: var(--dark-text);
            font-size: 1.25rem;
        }
        /* --- END HEADER BAR STYLES --- */

        .invalid-feedback {
            display: none;
            width: 100%;
            margin-top: .25rem;
            font-size: .875em;
            color: #dc3545;
        }
        .is-invalid ~ .invalid-feedback,
        .is-invalid ~ .form-text + .invalid-feedback {
            display: block;
        }

        .btn-primary {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
        }
        .btn-primary:hover {
            background-color: #5a0a9d;
            border-color: #5a0a9d;
        }
        .form-control:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 0.25rem rgba(106, 13, 173, 0.25);
        }
        
        /* New Password Strength Bar Styles */
        .password-strength-bar {
            height: 5px;
            margin-top: 5px;
            border-radius: 5px;
            background-color: #e9ecef; /* Default background */
            position: relative;
            overflow: hidden;
        }
        
        #strength-indicator {
            height: 100%;
            width: 0%;
            transition: width 0.3s ease, background-color 0.3s ease;
        }

        .strength-0 { background-color: #e9ecef !important; } /* Blank/Too short */
        .strength-1 { background-color: #dc3545 !important; width: 25% !important; } /* Red: Weak */
        .strength-2 { background-color: #ffc107 !important; width: 50% !important; } /* Yellow: Medium */
        .strength-3 { background-color: #20c997 !important; width: 75% !important; } /* Light Green: Strong */
        .strength-4 { background-color: #198754 !important; width: 100% !important; } /* Dark Green: Very Strong */
        
        .password-toggle {
            cursor: pointer;
        }
        
        .password-feedback-text {
            font-size: 0.875rem;
            margin-top: 5px;
        }
    </style>
</head>
<body>

    <!-- ========================================================== -->
    <!-- MOBILE-FRIENDLY HEADER BAR (NEW) -->
    <!-- ========================================================== -->
    <div id="mobile-header-bar">
        <!-- Left Arrow Button for back navigation -->
        <button id="back-button" onclick="history.back()">
            <i class="fas fa-arrow-left"></i>
        </button>
        <!-- Logo and Title -->
        <div id="header-logo-title" class="d-flex align-items-center">
            <img src="images/logo.png" alt="Hitaishi Careers Logo" height="30" class="me-2">
            <span class="fw-bold">Hitaishi Careers</span>
        </div>
    </div>
    
    <div class="container-wrapper">
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-md-8 col-lg-6">
                    <div class="card shadow-sm border-0">
                        <div class="card-body p-4 p-md-5">
                            <h2 class="card-title text-center fw-bold mb-4">Create Your Employer Account</h2>
                            <!-- Form for employer registration -->
                            <form id="register-form" novalidate>
                                <!-- Container for success/error messages -->
                                <div id="message-container"></div>

                                <div class="mb-3">
                                    <label for="companyName" class="form-label">Company Name</label>
                                    <input type="text" id="companyName" name="company_name" class="form-control" required>
                                    <div class="invalid-feedback">Please enter the company name.</div>
                                </div>
                                <div class="mb-3">
                                    <label for="email" class="form-label">Company Email</label>
                                    <input type="email" id="email" name="email" class="form-control" required>
                                    <div class="invalid-feedback">Please enter a valid email address.</div>
                                </div>
                                
                                <!-- Password Section: Updated for strength and visibility -->
                                <div class="mb-3">
                                    <label for="password" class="form-label">Password</label>
                                    <div class="input-group">
                                        <input type="password" id="password" name="password" class="form-control" required>
                                        <span class="input-group-text password-toggle" id="togglePassword">
                                            <i class="fas fa-eye-slash"></i>
                                        </span>
                                    </div>
                                    <!-- Strength Indicator Bar -->
                                    <div class="password-strength-bar">
                                        <div id="strength-indicator"></div>
                                    </div>
                                    <!-- Feedback Text -->
                                    <span id="passwordFeedback" class="password-feedback-text text-muted">Enter a password.</span>
                                    <div class="invalid-feedback">Your password does not meet the minimum requirements.</div>
                                </div>
                                <!-- End Password Section -->
                                
                                <div class="mb-3">
                                    <label for="website" class="form-label">Company Website <span class="text-muted">(Optional)</span></label>
                                    <input type="url" id="website" name="website" class="form-control" placeholder="https://example.com">
                                    <div class="invalid-feedback">Please enter a valid URL.</div>
                                </div>
                                <div class="mb-3">
                                    <label for="logoFile" class="form-label">Company Logo <span class="text-muted">(Optional, max 2MB)</span></label>
                                    <input type="file" id="logoFile" name="logo" class="form-control" accept="image/png, image/jpeg, image/gif">
                                    <div class="invalid-feedback">Please select a valid image file.</div>
                                </div>
                                 <div class="mb-3">
                                    <label for="contactPerson" class="form-label">Contact Person</label>
                                    <input type="text" id="contactPerson" name="contact_person" class="form-control" required>
                                    <div class="invalid-feedback">Please enter a contact person's name.</div>
                                </div>
                                 <div class="mb-3">
                                    <label for="contactPhone" class="form-label">Contact Phone</label>
                                    <input type="tel" id="contactPhone" name="contact_phone" class="form-control" required>
                                    <div class="invalid-feedback">Please enter a valid phone number.</div>
                                </div>
                                <div class="mb-3">
                                    <label for="address" class="form-label">Address</label>
                                    <textarea id="address" name="address" rows="2" class="form-control" required></textarea>
                                    <div class="invalid-feedback">Please enter your company address.</div>
                                </div>
                                <div class="mb-3">
                                    <label for="description" class="form-label">Company Description</label>
                                    <textarea id="description" name="description" rows="3" class="form-control"></textarea>
                                </div>
                                <div class="d-grid mt-4">
                                     <button type="submit" id="submit-button" class="btn btn-primary btn-lg">Register</button>
                                </div>
                            </form>

                            <!-- Looking for career growth -->
                            <p class="text-center text-muted mt-4 mb-0">
                                Looking for career growth? <a href="register.html">Register</a>
                            <p class="text-center text-muted mt-4 mb-0">
                                Already have an account? <a href="employerlogin.html">Login here</a>
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS Bundle CDN -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const form = document.getElementById('register-form');
            const messageContainer = document.getElementById('message-container');
            const submitButton = document.getElementById('submit-button');
            const passwordInput = document.getElementById('password');
            const togglePasswordButton = document.getElementById('togglePassword');
            const strengthIndicator = document.getElementById('strength-indicator');
            const passwordFeedback = document.getElementById('passwordFeedback');

            // --- Password Strength Calculation ---
            const checkPasswordStrength = (password) => {
                let score = 0;
                if (password.length > 7) score++;
                if (/[a-z]/.test(password) && /[A-Z]/.test(password)) score++;
                if (/\d/.test(password)) score++;
                if (/[^A-Za-z0-9]/.test(password)) score++; // Special characters
                return score;
            };

            const updateStrengthDisplay = (score) => {
                strengthIndicator.className = '';
                passwordInput.classList.remove('is-invalid'); // Remove error class when typing
                
                let text = '';
                let className = `strength-${score}`;

                if (score === 0) {
                    text = 'Enter a password.';
                    className = 'strength-0';
                } else if (score === 1) {
                    text = 'Weak (Needs length, numbers, and symbols)';
                } else if (score === 2) {
                    text = 'Medium (Try adding more complexity)';
                } else if (score === 3) {
                    text = 'Strong';
                } else if (score === 4) {
                    text = 'Very Strong!';
                }
                
                strengthIndicator.classList.add(className);
                passwordFeedback.textContent = text;
            };

            // Event listener for password strength update
            passwordInput.addEventListener('keyup', (e) => {
                const password = e.target.value;
                const score = checkPasswordStrength(password);
                updateStrengthDisplay(score);
            });
            
            // Initial call to set the default state
            updateStrengthDisplay(0);

            // --- Password Visibility Toggle ---
            togglePasswordButton.addEventListener('click', function() {
                const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
                passwordInput.setAttribute('type', type);
                // Toggle the eye icon
                this.querySelector('i').classList.toggle('fa-eye-slash');
                this.querySelector('i').classList.toggle('fa-eye');
            });
            
            // --- Validation Helper Functions ---
            const validateEmail = (email) => {
                const re = /^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
                return re.test(String(email).toLowerCase());
            };
            
            // Use the strength check for validation: minimum score of 3 (Strong) for submission
            const validatePasswordForSubmission = (password) => {
                return checkPasswordStrength(password) >= 3;
            };

            const validateUrl = (url) => {
                if (!url) return true; // Optional fields are valid if empty
                try {
                    // Simple check for valid structure
                    const urlPattern = /^(https?:\/\/)?([\da-z\.-]+)\.([a-z\.]{2,6})([\/\w \.-]*)*\/?$/;
                    return urlPattern.test(url);
                } catch (_) {
                    return false;
                }
            };
            
            const validateField = (input, validationFn, errorElementId) => {
                const isValid = validationFn(input.value);
                if (!isValid) {
                    input.classList.add('is-invalid');
                } else {
                    input.classList.remove('is-invalid');
                }
                return isValid;
            };

            form.addEventListener('submit', async function(e) {
                e.preventDefault();
                e.stopPropagation();

                messageContainer.innerHTML = '';
                form.querySelectorAll('.is-invalid').forEach(el => el.classList.remove('is-invalid'));
                
                let isFormValid = true;

                // --- Custom Client-Side Validations ---
                if (!validateField(document.getElementById('email'), validateEmail)) isFormValid = false;
                
                // Validate password using the strength function
                if (!validateField(passwordInput, validatePasswordForSubmission)) {
                    isFormValid = false;
                }

                if (!validateField(document.getElementById('website'), validateUrl)) isFormValid = false;
                
                // --- Bootstrap's HTML5 'required' validation ---
                form.querySelectorAll('[required]').forEach(input => {
                    if (!input.value.trim()) {
                         input.classList.add('is-invalid');
                         isFormValid = false;
                    }
                });

                if (!isFormValid) {
                    showMessage('Please correct the highlighted errors before submitting. Password must be strong (score 3 or higher).', 'danger');
                    return;
                }
                
                // Disable button to prevent multiple submissions
                submitButton.disabled = true;
                submitButton.textContent = 'Registering...';

                const formData = new FormData(form);

                try {
                    const response = await fetch('https://www.winjob.in/api/company/register', {
                        method: 'POST',
                        body: formData
                    });

                    const result = await response.json();

                    if (response.ok) { // Status 200-299
                        showMessage(result.message || 'Registration successful! Redirecting to login...', 'success');
                        form.reset();
                        setTimeout(() => {
                            window.location.href = 'employerlogin.html';
                        }, 2500);
                    } else {
                        // Display the specific error message from the server
                        showMessage(result.error || `Error ${response.status}: Registration failed.`, 'danger');
                    }
                } catch (error) {
                    console.error('Registration error:', error);
                    showMessage('An unexpected network error occurred. Please try again.', 'danger');
                } finally {
                    // Re-enable the button
                    submitButton.disabled = false;
                    submitButton.textContent = 'Register';
                }
            });

            function showMessage(message, type) {
                const wrapper = document.createElement('div');
                wrapper.innerHTML = `
                    <div class="alert alert-${type} alert-dismissible fade show" role="alert">
                        <span>${message}</span>
                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                    </div>`;
                messageContainer.innerHTML = ''; // Clear previous messages
                messageContainer.append(wrapper);
                window.scrollTo(0, 0); // Scroll to top to make sure user sees the message
            }
        });
    </script>
    
    <!-- Footer removed as requested -->
    
</body>
</html>
